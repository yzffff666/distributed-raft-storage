
æœ¬ç›®å½•åŒ…å«äº† Raft Storage é¡¹ç›®çš„å¤šç§ Kubernetes éƒ¨ç½²ç­–ç•¥é…ç½®å’Œè‡ªåŠ¨åŒ–è„šæœ¬ã€‚

## ğŸ“ ç›®å½•ç»“æ„

```
deployment-strategies/
â”œâ”€â”€ README.md                    # æœ¬æ–‡æ¡£
â”œâ”€â”€ rolling-update.yaml          # æ»šåŠ¨æ›´æ–°é…ç½®
â”œâ”€â”€ blue-green.yaml             # è“ç»¿éƒ¨ç½²é…ç½®
â”œâ”€â”€ canary.yaml                 # é‡‘ä¸é›€å‘å¸ƒé…ç½®
â”œâ”€â”€ deploy-rolling-update.sh    # æ»šåŠ¨æ›´æ–°è„šæœ¬
â”œâ”€â”€ deploy-blue-green.sh        # è“ç»¿éƒ¨ç½²è„šæœ¬
â””â”€â”€ deploy-canary.sh            # é‡‘ä¸é›€éƒ¨ç½²è„šæœ¬
```

## ğŸš€ éƒ¨ç½²ç­–ç•¥æ¦‚è¿°

### 1. æ»šåŠ¨æ›´æ–° (Rolling Update)

**ç‰¹ç‚¹ï¼š**
- é€æ­¥æ›¿æ¢æ—§ç‰ˆæœ¬Podï¼Œç¡®ä¿æœåŠ¡ä¸ä¸­æ–­
- æœ€å°åŒ–åœæœºæ—¶é—´
- èµ„æºæ¶ˆè€—ç›¸å¯¹è¾ƒä½
- é€‚åˆå¤§å¤šæ•°ç”Ÿäº§ç¯å¢ƒ

**ä½¿ç”¨åœºæ™¯ï¼š**
- æ—¥å¸¸ç‰ˆæœ¬æ›´æ–°
- å°ç‰ˆæœ¬è¡¥ä¸å‘å¸ƒ
- å‘åå…¼å®¹çš„æ›´æ–°

### 2. è“ç»¿éƒ¨ç½² (Blue-Green)

**ç‰¹ç‚¹ï¼š**
- åŒæ—¶è¿è¡Œä¸¤ä¸ªå®Œå…¨ç›¸åŒçš„ç”Ÿäº§ç¯å¢ƒ
- ç¬é—´åˆ‡æ¢ï¼Œé›¶åœæœºæ—¶é—´
- å¿«é€Ÿå›æ»šèƒ½åŠ›
- èµ„æºæ¶ˆè€—è¾ƒé«˜ï¼ˆéœ€è¦åŒå€èµ„æºï¼‰

**ä½¿ç”¨åœºæ™¯ï¼š**
- é‡å¤§ç‰ˆæœ¬å‘å¸ƒ
- å…³é”®ä¸šåŠ¡ç³»ç»Ÿæ›´æ–°
- éœ€è¦å¿«é€Ÿå›æ»šçš„åœºæ™¯

### 3. é‡‘ä¸é›€å‘å¸ƒ (Canary)

**ç‰¹ç‚¹ï¼š**
- æ¸è¿›å¼å‘å¸ƒï¼Œæ§åˆ¶é£é™©
- å¯é…ç½®æµé‡åˆ†é…æ¯”ä¾‹
- å®æ—¶ç›‘æ§å’Œè‡ªåŠ¨å›æ»š
- æ”¯æŒA/Bæµ‹è¯•

**ä½¿ç”¨åœºæ™¯ï¼š**
- æ–°åŠŸèƒ½éªŒè¯
- æ€§èƒ½å½±å“è¯„ä¼°
- é£é™©æ§åˆ¶è¦æ±‚é«˜çš„æ›´æ–°

## ğŸ› ï¸ å¿«é€Ÿå¼€å§‹

### æ»šåŠ¨æ›´æ–°éƒ¨ç½²

```bash
# åŸºæœ¬ç”¨æ³•
./deploy-rolling-update.sh

# æŒ‡å®šç‰ˆæœ¬
./deploy-rolling-update.sh v1.10.0
```

### è“ç»¿éƒ¨ç½²

```bash
# åŸºæœ¬ç”¨æ³•
./deploy-blue-green.sh

# æŒ‡å®šç‰ˆæœ¬å’Œç¯å¢ƒ
./deploy-blue-green.sh v1.10.0 raft-api blue green
```

### é‡‘ä¸é›€å‘å¸ƒ

```bash
# åŸºæœ¬ç”¨æ³•ï¼ˆ10%æµé‡ï¼‰
./deploy-canary.sh

# æŒ‡å®šæµé‡æ¯”ä¾‹
./deploy-canary.sh v1.10.0 raft-api 20
```

## ğŸ“Š ç›‘æ§å’ŒéªŒè¯

### å¥åº·æ£€æŸ¥

```bash
# æ£€æŸ¥PodçŠ¶æ€
kubectl get pods -n raft-storage -o wide

# å¥åº·æ£€æŸ¥API
kubectl port-forward service/raft-api-service -n raft-storage 8080:80
curl http://localhost:8080/api/v1/monitoring/health
```

### æ—¥å¿—ç›‘æ§

```bash
# å®æ—¶æŸ¥çœ‹æ—¥å¿—
kubectl logs -f deployment/raft-api-deployment -n raft-storage

# æŸ¥çœ‹äº‹ä»¶
kubectl get events -n raft-storage --sort-by='.lastTimestamp'
```

## ğŸ”„ å›æ»šæ“ä½œ

### æ»šåŠ¨æ›´æ–°å›æ»š

```bash
# å›æ»šåˆ°ä¸Šä¸€ä¸ªç‰ˆæœ¬
kubectl rollout undo deployment/raft-api-deployment -n raft-storage
```

### è“ç»¿éƒ¨ç½²å›æ»š

```bash
# å¿«é€Ÿå›æ»šï¼ˆåˆ‡æ¢æœåŠ¡æŒ‡å‘ï¼‰
kubectl patch service raft-api-service -n raft-storage \
  -p '{"spec":{"selector":{"environment":"blue"}}}'
```

### é‡‘ä¸é›€å›æ»š

```bash
# åœæ­¢é‡‘ä¸é›€æµé‡
kubectl scale deployment raft-api-canary -n raft-storage --replicas=0
```

## âš ï¸ æ³¨æ„äº‹é¡¹

### å®‰å…¨è€ƒè™‘

1. **é•œåƒå®‰å…¨**ï¼šç¡®ä¿ä½¿ç”¨ç»è¿‡å®‰å…¨æ‰«æçš„é•œåƒ
2. **æƒé™æ§åˆ¶**ï¼šä½¿ç”¨æœ€å°æƒé™åŸåˆ™é…ç½®ServiceAccount
3. **ç½‘ç»œç­–ç•¥**ï¼šé…ç½®NetworkPolicyé™åˆ¶Podé—´é€šä¿¡
4. **å¯†é’¥ç®¡ç†**ï¼šä½¿ç”¨Kubernetes Secretsç®¡ç†æ•æ„Ÿä¿¡æ¯

### èµ„æºç®¡ç†

1. **èµ„æºé™åˆ¶**ï¼šä¸ºæ‰€æœ‰å®¹å™¨è®¾ç½®åˆé€‚çš„èµ„æºè¯·æ±‚å’Œé™åˆ¶
2. **å­˜å‚¨ç®¡ç†**ï¼šç¡®ä¿PVCæœ‰è¶³å¤Ÿç©ºé—´ä¸”é…ç½®äº†å¤‡ä»½
3. **èŠ‚ç‚¹é€‰æ‹©**ï¼šä½¿ç”¨èŠ‚ç‚¹äº²å’Œæ€§ç¡®ä¿Podåˆ†å¸ƒ
4. **å®¹å¿åº¦é…ç½®**ï¼šå¤„ç†èŠ‚ç‚¹æ•…éšœå’Œç»´æŠ¤åœºæ™¯

## ğŸš¨ æ•…éšœæ’æŸ¥

### å¸¸è§é—®é¢˜

**1. éƒ¨ç½²å¤±è´¥**
```bash
# æ£€æŸ¥PodçŠ¶æ€å’Œäº‹ä»¶
kubectl describe pod <pod-name> -n raft-storage

# æŸ¥çœ‹å®¹å™¨æ—¥å¿—
kubectl logs <pod-name> -n raft-storage -c api
```

**2. å¥åº·æ£€æŸ¥å¤±è´¥**
```bash
# æ£€æŸ¥æ¢é’ˆé…ç½®
kubectl get deployment raft-api-deployment -n raft-storage -o yaml | grep -A 10 probe

# æ‰‹åŠ¨æµ‹è¯•å¥åº·æ£€æŸ¥
kubectl exec -it <pod-name> -n raft-storage -- curl localhost:8080/api/v1/monitoring/health
```

## ğŸ“š æœ€ä½³å®è·µ

1. **æ¸è¿›å¼å‘å¸ƒ**ï¼šä»å¼€å‘ç¯å¢ƒâ†’æµ‹è¯•ç¯å¢ƒâ†’é¢„ç”Ÿäº§ç¯å¢ƒâ†’ç”Ÿäº§ç¯å¢ƒ
2. **è‡ªåŠ¨åŒ–æµ‹è¯•**ï¼šé›†æˆå•å…ƒæµ‹è¯•ã€é›†æˆæµ‹è¯•ã€ç«¯åˆ°ç«¯æµ‹è¯•
3. **ç›‘æ§é©±åŠ¨**ï¼šåŸºäºç›‘æ§æ•°æ®å†³å®šæ˜¯å¦ç»§ç»­å‘å¸ƒ
4. **æ–‡æ¡£è®°å½•**ï¼šè¯¦ç»†è®°å½•æ¯æ¬¡å‘å¸ƒçš„å˜æ›´å’Œç»“æœ
5. **å›¢é˜Ÿåä½œ**ï¼šå»ºç«‹æ¸…æ™°çš„å‘å¸ƒæµç¨‹å’Œè´£ä»»åˆ†å·¥ 
# Kubernetes éƒ¨ç½²ç­–ç•¥
 