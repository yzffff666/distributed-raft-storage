global:
  # SMTPé…ç½®
  smtp_smarthost: 'localhost:587'
  smtp_from: 'alertmanager@raft-storage.local'
  smtp_auth_username: 'alertmanager@raft-storage.local'
  smtp_auth_password: 'password'
  smtp_require_tls: true

  # ä¼ä¸šå¾®ä¿¡é…ç½®
  wechat_api_url: 'https://qyapi.weixin.qq.com/cgi-bin/'
  wechat_api_secret: 'YOUR_WECHAT_SECRET'
  wechat_api_corp_id: 'YOUR_CORP_ID'

  # é’‰é’‰é…ç½®
  dingtalk_api_url: 'https://oapi.dingtalk.com/robot/send'

# æ¨¡æ¿é…ç½®
templates:
  - '/etc/alertmanager/templates/*.tmpl'

# è·¯ç”±é…ç½®
route:
  group_by: ['alertname', 'cluster', 'service']
  group_wait: 10s
  group_interval: 10s
  repeat_interval: 1h
  receiver: 'default-receiver'
  
  routes:
    # ä¸¥é‡å‘Šè­¦è·¯ç”± - ç«‹å³é€šçŸ¥æ‰€æœ‰æ¸ é“
    - match:
        severity: critical
      receiver: 'critical-alerts'
      group_wait: 0s
      group_interval: 5s
      repeat_interval: 15m
      
    # åŸºç¡€è®¾æ–½å‘Šè­¦è·¯ç”±
    - match:
        team: infrastructure
      receiver: 'infrastructure-team'
      group_interval: 5m
      repeat_interval: 2h
      
    # åº”ç”¨å‘Šè­¦è·¯ç”±
    - match:
        team: application
      receiver: 'application-team'
      group_interval: 5m
      repeat_interval: 1h
      
    # æ•°æ®åº“å‘Šè­¦è·¯ç”±
    - match:
        team: database
      receiver: 'database-team'
      group_interval: 5m
      repeat_interval: 1h
      
    # å­˜å‚¨å‘Šè­¦è·¯ç”±
    - match:
        team: storage
      receiver: 'storage-team'
      group_interval: 5m
      repeat_interval: 1h
      
    # ä¸šåŠ¡å‘Šè­¦è·¯ç”±
    - match:
        team: business
      receiver: 'business-team'
      group_interval: 10m
      repeat_interval: 2h
      
    # ç›‘æ§ç³»ç»Ÿå‘Šè­¦è·¯ç”±
    - match:
        team: monitoring
      receiver: 'monitoring-team'
      group_interval: 10m
      repeat_interval: 4h

# æŠ‘åˆ¶è§„åˆ™é…ç½®
inhibit_rules:
  # å¦‚æœå®ä¾‹å®•æœºï¼ŒæŠ‘åˆ¶è¯¥å®ä¾‹çš„å…¶ä»–å‘Šè­¦
  - source_match:
      alertname: ServiceDown
    target_match:
      instance: '.*'
    equal: ['instance']

  # å¦‚æœç£ç›˜ç©ºé—´ä¸¥é‡ä¸è¶³ï¼ŒæŠ‘åˆ¶ä¸€èˆ¬ç£ç›˜ç©ºé—´å‘Šè­¦
  - source_match:
      alertname: DiskSpaceCritical
    target_match:
      alertname: DiskSpaceLow
    equal: ['instance', 'mountpoint']

  # å¦‚æœRafté›†ç¾¤æ— Leaderï¼ŒæŠ‘åˆ¶å…¶ä»–Raftå‘Šè­¦
  - source_match:
      alertname: RaftNoLeader
    target_match_re:
      alertname: 'Raft.*'
    equal: ['cluster']

  # å¦‚æœRediså®•æœºï¼ŒæŠ‘åˆ¶Redisç›¸å…³å‘Šè­¦
  - source_match:
      alertname: RedisDown
    target_match_re:
      alertname: 'Redis.*'
    equal: ['instance']

# æ¥æ”¶å™¨é…ç½®
receivers:
  # é»˜è®¤æ¥æ”¶å™¨
  - name: 'default-receiver'
    email_configs:
      - to: 'admin@raft-storage.local'
        subject: '[Raft Storage] {{ .GroupLabels.alertname }}'
        body: |
          {{ range .Alerts }}
          å‘Šè­¦åç§°: {{ .Annotations.summary }}
          å‘Šè­¦æè¿°: {{ .Annotations.description }}
          å‘Šè­¦çº§åˆ«: {{ .Labels.severity }}
          å‘Šè­¦æ—¶é—´: {{ .StartsAt.Format "2006-01-02 15:04:05" }}
          {{ end }}

  # ä¸¥é‡å‘Šè­¦æ¥æ”¶å™¨ - å¤šæ¸ é“é€šçŸ¥
  - name: 'critical-alerts'
    email_configs:
      - to: 'admin@raft-storage.local,ops@raft-storage.local'
        subject: '[CRITICAL] Raft Storage ä¸¥é‡å‘Šè­¦'
        body: |
          ğŸš¨ ä¸¥é‡å‘Šè­¦é€šçŸ¥ ğŸš¨
          
          {{ range .Alerts }}
          å‘Šè­¦åç§°: {{ .Annotations.summary }}
          å‘Šè­¦æè¿°: {{ .Annotations.description }}
          å‘Šè­¦çº§åˆ«: {{ .Labels.severity }}
          å‘Šè­¦æ—¶é—´: {{ .StartsAt.Format "2006-01-02 15:04:05" }}
          å®ä¾‹: {{ .Labels.instance }}
          æœåŠ¡: {{ .Labels.job }}
          {{ end }}
          
          è¯·ç«‹å³å¤„ç†ï¼
        headers:
          X-Priority: '1'
    
    webhook_configs:
      - url: 'http://webhook-server:8080/alerts/critical'
        send_resolved: true
        http_config:
          basic_auth:
            username: 'alertmanager'
            password: 'webhook-secret'

    # ä¼ä¸šå¾®ä¿¡é€šçŸ¥
    wechat_configs:
      - agent_id: '1000001'
        to_user: '@all'
        message: |
          ğŸš¨ Raft Storage ä¸¥é‡å‘Šè­¦
          
          {{ range .Alerts }}
          å‘Šè­¦: {{ .Annotations.summary }}
          æè¿°: {{ .Annotations.description }}
          æ—¶é—´: {{ .StartsAt.Format "15:04:05" }}
          {{ end }}

  # åŸºç¡€è®¾æ–½å›¢é˜Ÿæ¥æ”¶å™¨
  - name: 'infrastructure-team'
    email_configs:
      - to: 'infra@raft-storage.local'
        subject: '[Infrastructure] {{ .GroupLabels.alertname }}'
        body: |
          åŸºç¡€è®¾æ–½å‘Šè­¦é€šçŸ¥
          
          {{ range .Alerts }}
          å‘Šè­¦åç§°: {{ .Annotations.summary }}
          å‘Šè­¦æè¿°: {{ .Annotations.description }}
          å‘Šè­¦çº§åˆ«: {{ .Labels.severity }}
          å‘Šè­¦æ—¶é—´: {{ .StartsAt.Format "2006-01-02 15:04:05" }}
          å®ä¾‹: {{ .Labels.instance }}
          {{ end }}

    # Slacké€šçŸ¥
    slack_configs:
      - api_url: 'https://hooks.slack.com/services/YOUR/SLACK/WEBHOOK'
        channel: '#infrastructure'
        username: 'AlertManager'
        title: 'Infrastructure Alert'
        text: |
          {{ range .Alerts }}
          *{{ .Annotations.summary }}*
          {{ .Annotations.description }}
          {{ end }}

  # åº”ç”¨å›¢é˜Ÿæ¥æ”¶å™¨
  - name: 'application-team'
    email_configs:
      - to: 'dev@raft-storage.local'
        subject: '[Application] {{ .GroupLabels.alertname }}'
        body: |
          åº”ç”¨å‘Šè­¦é€šçŸ¥
          
          {{ range .Alerts }}
          å‘Šè­¦åç§°: {{ .Annotations.summary }}
          å‘Šè­¦æè¿°: {{ .Annotations.description }}
          å‘Šè­¦çº§åˆ«: {{ .Labels.severity }}
          å‘Šè­¦æ—¶é—´: {{ .StartsAt.Format "2006-01-02 15:04:05" }}
          æœåŠ¡: {{ .Labels.job }}
          {{ end }}

    # é’‰é’‰é€šçŸ¥
    webhook_configs:
      - url: 'https://oapi.dingtalk.com/robot/send?access_token=YOUR_DINGTALK_TOKEN'
        send_resolved: true
        http_config:
          headers:
            Content-Type: 'application/json'
        body: |
          {
            "msgtype": "markdown",
            "markdown": {
              "title": "åº”ç”¨å‘Šè­¦é€šçŸ¥",
              "text": "{{ range .Alerts }}**{{ .Annotations.summary }}**\n\n{{ .Annotations.description }}\n\n{{ end }}"
            }
          }

  # æ•°æ®åº“å›¢é˜Ÿæ¥æ”¶å™¨
  - name: 'database-team'
    email_configs:
      - to: 'dba@raft-storage.local'
        subject: '[Database] {{ .GroupLabels.alertname }}'
        body: |
          æ•°æ®åº“å‘Šè­¦é€šçŸ¥
          
          {{ range .Alerts }}
          å‘Šè­¦åç§°: {{ .Annotations.summary }}
          å‘Šè­¦æè¿°: {{ .Annotations.description }}
          å‘Šè­¦çº§åˆ«: {{ .Labels.severity }}
          å‘Šè­¦æ—¶é—´: {{ .StartsAt.Format "2006-01-02 15:04:05" }}
          å®ä¾‹: {{ .Labels.instance }}
          {{ end }}

  # å­˜å‚¨å›¢é˜Ÿæ¥æ”¶å™¨
  - name: 'storage-team'
    email_configs:
      - to: 'storage@raft-storage.local'
        subject: '[Storage] {{ .GroupLabels.alertname }}'
        body: |
          å­˜å‚¨å‘Šè­¦é€šçŸ¥
          
          {{ range .Alerts }}
          å‘Šè­¦åç§°: {{ .Annotations.summary }}
          å‘Šè­¦æè¿°: {{ .Annotations.description }}
          å‘Šè­¦çº§åˆ«: {{ .Labels.severity }}
          å‘Šè­¦æ—¶é—´: {{ .StartsAt.Format "2006-01-02 15:04:05" }}
          èŠ‚ç‚¹: {{ .Labels.node_id }}
          {{ end }}

    webhook_configs:
      - url: 'http://storage-webhook:8080/alerts'
        send_resolved: true

  # ä¸šåŠ¡å›¢é˜Ÿæ¥æ”¶å™¨
  - name: 'business-team'
    email_configs:
      - to: 'business@raft-storage.local'
        subject: '[Business] {{ .GroupLabels.alertname }}'
        body: |
          ä¸šåŠ¡å‘Šè­¦é€šçŸ¥
          
          {{ range .Alerts }}
          å‘Šè­¦åç§°: {{ .Annotations.summary }}
          å‘Šè­¦æè¿°: {{ .Annotations.description }}
          å‘Šè­¦çº§åˆ«: {{ .Labels.severity }}
          å‘Šè­¦æ—¶é—´: {{ .StartsAt.Format "2006-01-02 15:04:05" }}
          {{ end }}

  # ç›‘æ§å›¢é˜Ÿæ¥æ”¶å™¨
  - name: 'monitoring-team'
    email_configs:
      - to: 'monitoring@raft-storage.local'
        subject: '[Monitoring] {{ .GroupLabels.alertname }}'
        body: |
          ç›‘æ§ç³»ç»Ÿå‘Šè­¦é€šçŸ¥
          
          {{ range .Alerts }}
          å‘Šè­¦åç§°: {{ .Annotations.summary }}
          å‘Šè­¦æè¿°: {{ .Annotations.description }}
          å‘Šè­¦çº§åˆ«: {{ .Labels.severity }}
          å‘Šè­¦æ—¶é—´: {{ .StartsAt.Format "2006-01-02 15:04:05" }}
          {{ end }} 